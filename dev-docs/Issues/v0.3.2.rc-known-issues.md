# v0.3.2.rc Known Issues

**Release Date**: 2025-07-20
**Status**: Release Candidate with Critical Issues

## Overview

Version 0.3.2.rc contains several critical issues that emerged after extensive iterative modifications to the codebase. The root causes of these bugs have not yet been fully identified due to the complex interactions between various system components.

## Critical Issues

### 1. React Mode `final_answer` Tool Error

**Severity**: High  
**Component**: `src/agents/react_agent.py`, `src/tools/final_answer.py`  
**Status**: Partially mitigated with workaround

#### Description
In DeepSearchAgents React mode, after the Agent Action calls the custom `final_answer` tool, the system consistently reports that the final answer is empty, resulting in execution failure.

#### Symptoms
- Agent successfully performs search and analysis steps
- When calling `final_answer`, the tool receives empty arguments: `{'answer': {}}`
- System returns error message about empty final answer
- Often occurs at planning interval steps (e.g., step 7 when `planning_interval=3`)

#### Attempted Workarounds
- Implemented `DebuggingToolCallingAgent` wrapper to catch and handle empty calls
- Added retry logic (max 2 attempts) with instructive error messages
- Enhanced prompt templates with explicit format requirements
- Added diagnostic logging to identify planning step correlation

#### Root Cause
Unknown - possibly related to:
- Model confusion between planning and action steps
- Prompt template ambiguity
- State management issues during planning intervals

---

### 2. Wolfram Tool Execution Errors

**Severity**: High  
**Component**: `src/tools/wolfram.py`  
**Status**: Attempted fix, may still fail

#### Description
The Wolfram tool encounters `UnboundLocalError` when running under both React and CodeAct modes.

#### Symptoms
```
UnboundLocalError: cannot access local variable 'res' where it is not associated with a value
```

#### Technical Details
- Error occurs in exception handler when `res` variable is accessed before being defined
- Happens when `wolfram_client.query()` throws an exception
- Lines 103-110 in `wolfram.py` try to access `res.success` and `res.didyoumeans`

#### Attempted Fix
```python
# Added at line 52
res = None  # Initialize res to avoid UnboundLocalError

# Modified exception handler at lines 104, 107
if res is not None and hasattr(res, 'success') and res.success == 'false':
    # ... handle error
```

#### Potential Root Causes
- Missing or invalid Wolfram Alpha API credentials
- Python interpreter sandbox environment configuration issues
- Network connectivity problems
- API rate limiting

---

### 3. ReadURLTool Event Loop Errors

**Severity**: Medium-High  
**Component**: `src/core/scraping/` module  
**Status**: Unresolved

#### Description
The newly optimized `ReadURLTool` module experiences event loop errors during runtime aggregation parsing when parsers automatically invoke JinaReaderScraper or FirecrawlScraper.

#### Symptoms
- Error messages: "Event loop is closed"
- Async scraping failures
- Parser aggregation failures
- Intermittent parsing failures even for accessible URLs

#### Affected Components
- `src/core/scraping/scraper_jinareader.py`
- `src/core/scraping/scraper_firecrawl.py`
- `src/core/scraping/scrape_url.py`

#### Technical Details
- Appears to be related to async/await handling in scraper implementations
- May involve improper event loop management in concurrent scraping attempts
- Possibly related to context manager lifecycle issues

#### Root Cause
Unknown - requires investigation of:
- Event loop lifecycle management
- Async context handling in scrapers
- Concurrent execution patterns
- Resource cleanup procedures

---

## Contributing Factors

1. **Extensive Iterative Modifications**: The codebase has undergone numerous incremental changes without comprehensive integration testing
2. **Complex Dependencies**: Interactions between smolagents, async scrapers, and various tool implementations
3. **State Management**: Potential issues with agent state persistence across planning intervals
4. **Async/Sync Boundaries**: Mixed async and sync code patterns may be causing event loop issues

## Recommended Next Steps

1. **Implement comprehensive logging** throughout the agent execution pipeline
2. **Create isolated test cases** for each issue to reproduce consistently
3. **Review state management** during planning intervals
4. **Audit async/await patterns** in scraping modules
5. **Consider reverting** to previous stable versions for critical components
6. **Add integration tests** for multi-step agent workflows

## Workarounds for Users

1. **For final_answer errors**: Monitor logs and retry queries if empty answer detected
2. **For Wolfram errors**: Verify API credentials and consider using alternative calculation tools
3. **For scraping errors**: Use direct URL reading when possible, avoid concurrent scraping

## References

- Original issue tracking: Internal development logs
- Related commits: See git history for v0.3.2 branch
- Dependencies: smolagents v1.20.0, wolframalpha, aiohttp, asyncio